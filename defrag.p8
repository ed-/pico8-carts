pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- defrag
-- slumberheart

function _init()
  cls()
  _mode = 0
  _frame = 0
  game = new_game()
end

function _update()
  _frame = (_frame + 1) % 30
  if _mode == 0 then
    update(game)
  else
  end
end

function _draw()
  cls()
  if _mode == 0 then
    draw(game)
  else
  end
end

function update(something)
  something:update()
end

function draw(something)
  something:draw()
end
-->8
-- game

function new_game()

  local game = {}
  
  game.actors = {}
  game.cells = {}
  for i = 0, 32 * 16 do
    add(game.actors, new_cell(i))
    game.cells[i] = i
  end
  
  add(game.actors, new_cursor())
    
  game.update = function(self)
    foreach(game.actors, update)
  end

  game.draw = function(self)
    foreach(game.actors, draw)
  end
  
  return game
end
-->8
-- cursor
function new_cursor()
  z = {}
  
  z.x = 0
  z.y = 0
  z.c = 0
  z._max = 32 * 16
  
  z.update = function(self)
    if btnp(0) then
      self:left()
    end
    if btnp(1) then
      self:right()
    end
    if btnp(2) then
      self:up()
    end
    if btnp(3) then
      self:down()
    end
    self.x = flr(self.c % 32) * 4
    self.y = flr(self.c / 32) * 8
  end

  z.left = function(self)
    if (self.c > 0) then
      self.c -= 1
    end
  end

  z.right = function(self)
    if (self.c < self._max - 1) then
      self.c += 1
    end
  end

  z.up = function(self)
    if (self.c > 31) then
      self.c -= 32
    end
  end

  z.down = function(self)
    if (self.c < self._max - 32) then
      self.c += 32
    end
  end
  
  z.draw = function(self)
    spr(9, self.x, self.y)
    local c = game.cells[self.c]
    for i=-1,1 do
      for j=-1,1 do
        print(c, 1 + i, 122 + j, 0)
      end
    end
    print(c, 1, 122, 7)
  end
  
  return z
end
-->8
-- cell

function new_cell(id)
  local z = {}
  
  z.id = id
  z.position = id
  
  z.x = -4
  z.y = -8
  
  z._off = 10
  z._red = 11
  z._green = 12
  
  z.state = 0
  
  z.update = function(self)
    if self.state == self._off then
      return
    end
    
    self.x = (self.position % 32) * 4
    self.y = flr(self.position / 32) * 8

    if self.id == self.position then
      self.state = self._green
    else
      self.state = self._red
    end
  end
  
  z.draw = function(self)
    spr(self.state, self.x, self.y)
  end
  
  return z
end
__gfx__
000000000660066006607ee806607aab000000000000000000000000000000000000000077770000066000007ee800007aab0000000000000000000000000000
00000000600560056005e8826005abb300000000000000000000000000000000000000007007000060050000e8820000abb30000000000000000000000000000
00700700600560056005e8826005abb300000000000000000000000000000000000000007007000060050000e8820000abb30000000000000000000000000000
00077000600560056005e8826005abb300000000000000000000000000000000000000007007000060050000e8820000abb30000000000000000000000000000
00077000600560056005e8826005abb300000000000000000000000000000000000000007007000060050000e8820000abb30000000000000000000000000000
00700700600560056005e8826005abb300000000000000000000000000000000000000007007000060050000e8820000abb30000000000000000000000000000
00000000600560056005e8826005abb300000000000000000000000000000000000000007007000060050000e8820000abb30000000000000000000000000000
0000000005500550055082210550b3310000000000000000000000000000000000000000777700000550000082210000b3310000000000000000000000000000
000000007ee806607ee87ee87ee87aab000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e8826005e882e882e882abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e8826005e882e882e882abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e8826005e882e882e882abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e8826005e882e882e882abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e8826005e882e882e882abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e8826005e882e882e882abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000082210550822182218221b331000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007aab06607aab7ee87aab7aab000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000abb36005abb3e882abb3abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000abb36005abb3e882abb3abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000abb36005abb3e882abb3abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000abb36005abb3e882abb3abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000abb36005abb3e882abb3abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000abb36005abb3e882abb3abb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b3300550b3318221b331b331000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
