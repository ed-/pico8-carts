pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- skeletonwar
-- slumberheart

--[[

if your grave doesnt say "rest
in peace" on it you are
automatically drafted into the
skeleton war

- @dril

]]

function _init()
  cls()
  _mode = 0
  _frame = 0
  _game = game:new()
  _game:reset()
end

function _update()
  _frame = (_frame + 1) % 30
  if _mode == 0 then
    _game:update()
  else
  end
end

function _draw()
  cls()
  if _mode == 0 then
    draw(game)
  else
  end
end

function update(something)
  something:update()
end

function draw(something)
  something:draw()
end
-->8
-- game
game = {
  warriors = {},
  skeletons = {},
}

function game:new(z)
  z = z or {}
  setmetatable(z, self)
  self.__index = self
  return z
end

function game:reset()
  add(self.warriors, warrior:new{})
end
 
function game:update()
  foreach(self.warriors, update)
  foreach(self.skeletons, update)
end

function game:draw()
  foreach(self.warriors, draw)
  foreach(self.skeletons, draw)
end
-->8
--actor
actor = {
  dx = 0,
  dy = 0,
  x = 0,
  y = 0,
  sprite = 0,
  facing = false
}

function actor:new(z)
  z = z or {}
  setmetatable(z, self)
  self.__index = self
  return z
end

function actor:move()
  self.x += self.dx
  if self.x >= 120 then
    self.x = 120
  end
  if self.x < 0 then
    self.x = 0
  end
  
  self.y += self.dy
  if self.y >= 120 then
    self.y = 120
  end
  if self.y < 0 then
    self.y = 0
  end
end

function actor:update()
  self.facing = self.dx < 0
end

function actor:draw()
  spr(self.sprite, self.x, self.y, 1, 1, self.dx < 0)
end
-->8
-- warrior
warrior = {
  dx = 0,
  dy = 0,
  x = 0,
  y = 0,
  maxspeed = 0,
  facing = false
}

function warrior:new(z)
  z = z or {}
  setmetatable(z, self)
  self.__index = self
  return z
end

 
function warrior:update()
  local do_decay = true
  if btn(0) then
    self:left()
    do_decay = false
  end
  if btn(1) then
    self:right()
    do_decay = false
  end
  if btn(2) then
    self:up()
    do_decay = false
  end
  if btn(3) then
    self:down()
    do_decay = false
  end
  if do_decay then
    self:decay()
  end
  self:move()
end


function warrior:left()
  if (self.dx > -4) then
    self.dx -= 1
  end
  self.facing = true
end

function warrior:right()
  if (self.dx < 4) then
    self.dx += 1
  end
  self.facing = false
end

function warrior:up()
  if (self.dy > -4) then
    self.dy -= 1
  end
end

function warrior:down()
  if (self.dy < 4) then
    self.dy += 1
  end
end
  
function warrior:decay()
  if self.dx < 0 then
    self.dx += 1
  elseif self.dx > 0 then
    self.dx -= 1
  end
  if self.dy < 0 then
    self.dy += 1
  elseif self.dy > 0 then
    self.dy -= 1
  end
end
  
function warrior:move()
  self.lastx = self.x
  self.lasty = self.y
    
  self.x += self.dx
  if self.x >= 120 then
    self.x = 120
  end
  if self.x < 0 then
    self.x = 0
  end
  self.y += self.dy
  if self.y >= 120 then
    self.y = 120
  end
  if self.y < 0 then
    self.y = 0
  end

end
  
function warrior:draw()
  spr(2, self.lastx, self.lasty, 1, 1, self.facing)
  spr(18, self.x, self.y, 1, 1, self.facing)
end
__gfx__
00000000000000000011000011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005665000111101001111000000000000000000000000000000000000000000000000000000000000056650000000000000000000000000000000000
00700700000770000151501001515000000000000000000000000000000000000000000000000000000000000007700000000000000000000000000000000000
00077000000220000111101001111000000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000
00077000002e9800111111111111110000000000000000000000000000000000000000000000000000000000002e980000000000000000000000000000000000
0070070002e9888011111010111111100000000000000000000000000000000000000000000000000000000002e9888000000000000000000000000000000000
00000000008888000111100001111000000000000000000000000000000000000000000000000000000000000088880000000000000000000000000000000000
00000000000000000100100011111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbb00401ccc0000006600008888000022220000006600000066000000ff004010cc010000a0a000009900000000000000000000000000000000000000000000
0b3330040c11109006666060082220000288800006666000066660000ffff0401cccc1000aaaa000094440600000000000000000000000000000000000000000
030f0004010f004005060060020f0000080f000006060000060600000f0f00400c0c0000050f0000040f00660000000000000000000000000000000000000000
0ffff0040ffff04005fff07009fff0000ffff0000fffcccc0ffff0000ffff0400ffff00005fff0000ffff0060000000000000000000000000000000000000000
3bbbb3f41c66c1f0541145f588888800222222008888cc6c888888f099ff99f052222500222222005555557f0000000000000000000000000000000000000000
f5565004fccac040f1161050f44a48f0f11518f0f119c6c6f1191800f9999040fccccf00f77c76f0f76d67000000000000000000000000000000000000000000
0bbbb0040cccc0400444400008888000288882008666cccc866668000888804001cc105026666200566665000000000000000000000000000000000000000000
04004040c5cc504005005000858858002400420084004cc084004800040040400500500625225200550055000000000000000000000000000000000000000000
00660040006600000066000000660000006600000066000000660000006600404066040000a0a000006600000000000000000000000000000000000000000000
0677700406777040067770400677700006777000067770000677700006777040467774000aaaa000067770600000000000000000000000000000000000000000
06878004068780400687804006878000068780000687800006878000068780400687800006878000068780660000000000000000000000000000000000000000
00777004007770400077704000777000007770000077222200777000007770400077700000777000007770060000000000000000000000000000000000000000
3bbbb3741cccc17054554570cccccc0022222200444422d24444447099dd997052222500111111005555557d0000000000000000000000000000000000000000
7dd6d0047ccac0407dd6d0507dd6dc70711d147071192d2d71191400799990407cccc700677c7660d76d67000000000000000000000000000000000000000000
0bbbb0040cccc040044440000cccc0002444420046662222466664000444404001cc105046666400566665000000000000000000000000000000000000000000
05005040c5cc504005005000c5cc5c00250052004500522045005400050050400500500645445400550055000000000000000000000000000000000000000000
000000000000330004000000000000000000000000000000a094090000000000a094090000000000000000000000000000000000000000000000000000000000
000000000003abb00440bb0000000000000000000066660094666640006666009466664000000000000000000000000000000000000000000000000000000000
00000000003bbb80444bbbb000000000000000000667776046677760066777604667776000000000000000000000000000000000000000000000000000000000
00011000003bb008445b4b4000000000000000000677777606777776067787760677977600000000000000000000000000000000000000000000000000000000
001dd100003b000044c5bbb000000000000000000067878604679796006777760467777600000000000000000000000000000000000000000000000000000000
01dccd10000b0000040555c000022020000000000006767000967670000676700096767000000000000000000000000000000000000000000000000000000000
0dc8c8d03003b00004030300002222c2000ff0000000606000006060000060600000606000000000000000000000000000000000000000000000000000000000
dccccccd033b00000000000042f22f000ff00f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
